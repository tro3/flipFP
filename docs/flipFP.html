<!DOCTYPE html>

<html>
<head>
  <title>flipFP.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>flipFP.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>Q = <span class="hljs-built_in">require</span> <span class="hljs-string">'q'</span>
x = <span class="hljs-built_in">module</span>.exports
p = <span class="hljs-built_in">console</span>.log

defers = []</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Given a unary function f(x):</p>
<p>It can be passed one of three things:</p>
<ol>
<li>A value</li>
<li>A promise</li>
<li>Another function (which may return a value or a promise)</li>
</ol>
<p>Execute and pipe wrappers:</p>
<p>  f’(x) = | x is value -&gt; f(x)
          | x is promise -&gt; x.then((val) -&gt; f(val))</p>
<p>  With f’ we know we are executing</p>
<p>  f’’(x) = | x is function g(y) -&gt; h(y) = f’(g(y))
           | otherwise f’(x)</p>
<p>  With f’’ we may be compiling</p>
<p>Given a function <em>generator</em> F(a,b,…) that generates a unary function f(x)</p>
<p>It can be passed two quantities of parameters</p>
<p>  a. The correct amount
  b. The correct amount + 1, intending to execute the generated function</p>
<p>  F’(a,b,…) = F(a,b,…)’’ = f’’
  F’(a,b,…,x) = F(a,b,…)’’(x) = f’’(x)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function">

<span class="hljs-title">_isFunction</span> = <span class="hljs-params">(x)</span> -&gt;</span> <span class="hljs-keyword">typeof</span> x == <span class="hljs-string">'function'</span>
<span class="hljs-function"><span class="hljs-title">_isPromise</span> = <span class="hljs-params">(x)</span> -&gt;</span> x != <span class="hljs-literal">null</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> x == <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-string">'then'</span> <span class="hljs-keyword">of</span> x</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>f’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_execWrap</span> = <span class="hljs-params">(f)</span> -&gt;</span>
  (x) -&gt;
    <span class="hljs-keyword">if</span> _isPromise x <span class="hljs-keyword">then</span> x.<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">(y)</span> -&gt;</span> f(y))          <span class="hljs-comment"># exec promise</span>
    <span class="hljs-keyword">else</span>                 f(x)                         <span class="hljs-comment"># exec primitive</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>f’’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.pipeWrap = pipeWrap = <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
  (g) -&gt;
    <span class="hljs-keyword">if</span> _isFunction g
      <span class="hljs-keyword">if</span> g.length == <span class="hljs-number">1</span>
        pipeWrap () -&gt; _execWrap(f)(g.apply(<span class="hljs-literal">null</span>, arguments))   <span class="hljs-comment"># pipe unary function</span>
      <span class="hljs-keyword">else</span>
        () -&gt; _execWrap(f)(g.apply(<span class="hljs-literal">null</span>, arguments))            <span class="hljs-comment"># pipe function</span>
    <span class="hljs-keyword">else</span>
      _execWrap(f)(g)                                           <span class="hljs-comment"># pipe value (promise or primitive)</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>F’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_splitArgs</span> = <span class="hljs-params">(n)</span> -&gt;</span> (lst) -&gt; [(lst[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..n]), lst[n]]
x.genWrap = genWrap = <span class="hljs-function"><span class="hljs-params">(F)</span> -&gt;</span>
  n = F.length
  split = _splitArgs(n)
  () -&gt;
    <span class="hljs-keyword">if</span> arguments.length == n <span class="hljs-keyword">then</span> pipeWrap F.apply(<span class="hljs-literal">null</span>, arguments)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> arguments.length == n+<span class="hljs-number">1</span>
      [args, x] = split arguments
      f = F.apply(<span class="hljs-literal">null</span>, args)
      pipeWrap(f)(x)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">'Incorrect argument count'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="normal-functions">Normal Functions</h2>
<p>Functions that do not generate promises</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>all</strong> =&gt; (a -&gt; Boolean) -&gt; ([a] -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_all</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  (lst) -&gt;
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> !(fn item)
    <span class="hljs-literal">true</span>
x.all = all = genWrap _all</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>allPass</strong> =&gt; [(a -&gt; Boolean)] -&gt; (a -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_allPass</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
  (val) -&gt;
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> !(fcn val)
    <span class="hljs-literal">true</span>
x.allPass = allPass = genWrap _allPass</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>always</strong> =&gt; a -&gt; (* -&gt; a)</p>
<p>Piping makes no sense</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.always = always = <span class="hljs-function"><span class="hljs-params">(val)</span> -&gt;</span>
  () -&gt; val</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>any</strong> =&gt; (a -&gt; Boolean) -&gt; ([a] -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_any</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  (lst) -&gt;
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> (fn item)
    <span class="hljs-literal">false</span>
x.any = any = genWrap _any</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>anyPass</strong> =&gt; [(a -&gt; Boolean)] -&gt; (a -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_anyPass</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
  (val) -&gt;
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> (fcn val)
    <span class="hljs-literal">false</span>
x.anyPass = anyPass = genWrap _anyPass</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>callAll</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_callAll</span> = <span class="hljs-params">(fcns)</span> -&gt;</span>
  (val) -&gt;
    result = []
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns
      result.push fcn val
    result
x.callAll = callAll = genWrap _callAll</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>chain</strong> =&gt; (a -&gt; []) -&gt; ([a] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_chain</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> fcn(item)
        result.push res
    result
x.chain = chain = genWrap _chain</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>compose</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>
<p>Can’t be genWrap’d due to unknown arg count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.compose = compose = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  fcns = fcns.reverse()
  () -&gt;
    val = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
      val = fcn(val)
    val</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>concat</strong> =&gt; []… -&gt; []</p>
<p>Can’t be genWrap’d due to unknown arg count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.concat = concat = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
  result = []
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..arguments.length]
    list = arguments[i]
    list = [list] <span class="hljs-keyword">if</span> !(list <span class="hljs-keyword">instanceof</span> Array)
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> list
      result.push item
  result</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>clone</strong> =&gt; {} -&gt; {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>defers.push -&gt;
  x.clone = clone = traverseObj id,id,id</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>drop</strong> =&gt; Int -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_drop</span> = <span class="hljs-params">(n)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [n...lst.length]
      r.push lst[i]
    r
x.drop = drop = genWrap _drop</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>filter</strong> =&gt; (a -&gt; Boolean) -&gt; ([] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_filter</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      r.push item <span class="hljs-keyword">if</span> fcn item
    r
x.filter = filter = genWrap _filter</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>filterIndex</strong> =&gt; (a,i -&gt; Boolean) -&gt; ([] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_filterIndex</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..lst.length]
      r.push lst[i] <span class="hljs-keyword">if</span> fcn lst[i], i
    r
x.filterIndex = filterIndex = genWrap _filterIndex</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>flatten</strong> =&gt; [[]] -&gt; []</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_flatten</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
  r = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
    <span class="hljs-keyword">if</span> item <span class="hljs-keyword">instanceof</span> Array
      subs = _flatten item
      r = r.concat subs
    <span class="hljs-keyword">else</span> r.push item
  r
x.flatten = flatten = pipeWrap _flatten</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>id</strong> =&gt; a -&gt; a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.id = id = <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> a</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><strong>init</strong> =&gt; [] -&gt; []</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_init</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..lst.length-<span class="hljs-number">1</span>]
      r.push lst[i]
    r
x.init = init = genWrap _init</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>isNothing</strong> =&gt; a -&gt; Boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_isNothing</span> = <span class="hljs-params">(a)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> a <span class="hljs-keyword">in</span> [<span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>]
  <span class="hljs-keyword">return</span> a.trim().length == <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a == <span class="hljs-string">'string'</span>
  <span class="hljs-keyword">return</span> Object.keys(a).length == <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a == <span class="hljs-string">'object'</span> 
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
x.isNothing = isNothing = pipeWrap _isNothing</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>keys</strong> =&gt; ({} -&gt; [String])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_keys</span> = <span class="hljs-params">(a)</span> -&gt;</span> Object.keys a
x.keys = keys = pipeWrap _keys</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>map</strong> =&gt; (a -&gt; a) -&gt; ([a] -&gt; [a])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_map</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      result.push fcn(item)
    result
x.map = map = genWrap _map</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>mapIndex</strong> =&gt; (a,Int -&gt; a) -&gt; ([a] -&gt; [a])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_mapIndex</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..lst.length]
      result.push fcn(lst[i], i)
    result
x.mapIndex = mapIndex = genWrap _mapIndex</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>mapKeys</strong> =&gt; (String -&gt; a) -&gt; ([String] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_mapKeys</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = {}
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> lst
      result[key] = fcn(key)
    result
x.mapKeys = mapKeys = genWrap _mapKeys</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>mapObj</strong> =&gt; (a -&gt; a) -&gt; ({} -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_mapObj</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (obj) -&gt;
    result = {}
    <span class="hljs-keyword">for</span> key, item <span class="hljs-keyword">of</span> obj
      result[key] = fcn(item)
    result
x.mapObj = mapObj = genWrap _mapObj</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><strong>merge</strong> =&gt; {} -&gt; ({} -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>defers.push -&gt;
<span class="hljs-function">  <span class="hljs-title">_merge</span> = <span class="hljs-params">(old)</span> -&gt;</span>
<span class="hljs-function">    <span class="hljs-title">loopFn</span> = <span class="hljs-params">(o, n)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> o <span class="hljs-keyword">if</span> n == <span class="hljs-literal">undefined</span>
      <span class="hljs-keyword">if</span> n <span class="hljs-keyword">instanceof</span> Array
        <span class="hljs-keyword">if</span> o <span class="hljs-keyword">instanceof</span> Array <span class="hljs-keyword">then</span> loopOverList o, n
        <span class="hljs-keyword">else</span> n
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> n == <span class="hljs-string">'object'</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> o == <span class="hljs-string">'object'</span> <span class="hljs-keyword">then</span> loopOverObj o, n
      <span class="hljs-keyword">else</span> n    
<span class="hljs-function">    <span class="hljs-title">loopOverList</span> = <span class="hljs-params">(o,n)</span> -&gt;</span> (loopFn(o[i],n[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..n.length])  
<span class="hljs-function">    <span class="hljs-title">loopOverObj</span> = <span class="hljs-params">(o,n)</span> -&gt;</span> _mapKeys(<span class="hljs-function"><span class="hljs-params">(k)</span> -&gt;</span> loopFn(o[k],n[k]))(_union(_keys o)(_keys n))

    (new_) -&gt;
      loopOverObj(old, new_)
      
  x.merge = merge = genWrap _merge</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>pipe</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>
<p>Can’t be genWrap’d due to unknown arg count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.pipe = pipe = <span class="hljs-function">-&gt;</span>
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  () -&gt;
    val = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
      val = fcn(val)
    val</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>prop</strong> =&gt; String -&gt; ({} -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_prop</span> = <span class="hljs-params">(key)</span> -&gt;</span> (obj) -&gt; obj[key]
x.prop = prop = genWrap _prop</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>reduce</strong> =&gt; (b,a -&gt; b) -&gt; b -&gt; ([a] -&gt; b)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.reduce = reduce = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_reduce</span> = <span class="hljs-params">(fcn, init, lst)</span> -&gt;</span>
    acc = init
    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> lst
      acc = fcn(acc, val)
    acc

  fcn = arguments[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> arguments.length &gt; <span class="hljs-number">1</span>
    init = arguments[<span class="hljs-number">1</span>]
    (lst) -&gt; _reduce(fcn, init, lst)
  <span class="hljs-keyword">else</span>
    (init, lst) -&gt; _reduce(fcn, init, lst)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>splitAt</strong> =&gt; Int -&gt; ([] -&gt; [[],[]])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_splitAt</span> = <span class="hljs-params">(n)</span> -&gt;</span>
  (lst) -&gt;
    r1 = []
    r2 = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..lst.length]
      <span class="hljs-keyword">if</span> i &lt; n <span class="hljs-keyword">then</span> r1.push lst[i] <span class="hljs-keyword">else</span> r2.push lst[i]
    [r1,r2]
x.splitAt = splitAt = genWrap _splitAt</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>splitHead</strong> =&gt; [a] -&gt; [a,[]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_splitHead</span> = <span class="hljs-params">(lst)</span> -&gt;</span> [lst[<span class="hljs-number">0</span>], tail lst]
x.splitHead = splitHead = pipeWrap _splitHead</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><strong>splitLast</strong> =&gt; [a] -&gt; [[],a]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_splitHead</span> = <span class="hljs-params">(lst)</span> -&gt;</span> [init lst, lst[-<span class="hljs-number">1.</span>.-<span class="hljs-number">1</span>]]
x.splitLast = splitLast = pipeWrap _splitHead</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><strong>tail</strong> =&gt; [] -&gt; []</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_tail</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>..lst.length]
      r.push lst[i]
    r
x.tail = tail = pipeWrap _tail</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><strong>take</strong> =&gt; Int -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_take</span> = <span class="hljs-params">(n)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..n]
      r.push lst[i]
    r
x.take = take = genWrap _take</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>traverseObj</strong> =&gt; (a -&gt; a) -&gt; ({} -&gt; {}) -&gt; ({} -&gt; {}) -&gt; ({} -&gt; {})</p>
<p>The first object function is executed before descending, the second operates
on the object resulting after descending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.traverseObj = traverseObj = <span class="hljs-function"><span class="hljs-params">(valFcn, preFcn, postFcn)</span> -&gt;</span>
<span class="hljs-function">  <span class="hljs-title">loopFn</span> = <span class="hljs-params">(val)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> val <span class="hljs-keyword">instanceof</span> Array <span class="hljs-keyword">then</span> loopOverList val
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> val == <span class="hljs-string">'object'</span> <span class="hljs-keyword">then</span> processObj val
    <span class="hljs-keyword">else</span> valFcn val

  loopOverObj = mapObj loopFn
  loopOverList = _map loopFn
  
  processObj = pipe(
    preFcn
    loopOverObj
    postFcn
  )</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>union</strong> =&gt; [] -&gt; ([] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_union</span> = <span class="hljs-params">(olst)</span> -&gt;</span>
  (nlst) -&gt;
    r = (olst[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..olst.length])
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..nlst.length]
      r.push nlst[i] <span class="hljs-keyword">if</span> nlst[i] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> r
    r
x.union = union = genWrap _union</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>zipObj</strong> =&gt; [] -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_zip</span> = <span class="hljs-params">(keys)</span> -&gt;</span>
  (vals) -&gt;
    r = {}
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..keys.length]
      r[keys[i]] = vals[i]
    r
x.zipObj = zipObj = genWrap _zip</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>zipKeys</strong> =&gt; (String -&gt; a) -&gt; ([String] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_zipKeys</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (keys) -&gt;
    r = {}
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys
      r[key] = fcn key
    r
x.zipKeys = zipKeys = genWrap _zipKeys</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h2 id="q-functions">Q Functions</h2>
<p> Functions that operate on promises</p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><strong>qCompose</strong> =&gt; [(a -&gt; Q a)] -&gt; (a -&gt; Q a)</p>
<p>Can’t be genWrap’d due to unknown arg count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.qCompose = qCompose = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_qPipe</span> = <span class="hljs-params">(f1,f2)</span> -&gt;</span>
    () -&gt; f1.apply(<span class="hljs-literal">null</span>, arguments).<span class="hljs-keyword">then</span> (x) -&gt; f2(x)
  
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  fcns = fcns.reverse()
<span class="hljs-function">  <span class="hljs-title">q</span> = <span class="hljs-params">()</span> -&gt;</span> fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-literal">null</span>, arguments)
  <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
    q = _qPipe(q, fcn)
  q</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><strong>qFilter</strong> =&gt; (a -&gt; Q Boolean) -&gt; ([] -&gt; Q [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_qFilter</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    qs = []
    r = []
    [<span class="hljs-number">0.</span>..lst.length].forEach (i) -&gt;
      qs.push fcn(lst[i]).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">(b)</span> -&gt;</span> r[i] = b)
    Q.all(qs).<span class="hljs-keyword">then</span> -&gt; _filterIndex(<span class="hljs-function"><span class="hljs-params">(b,i)</span>-&gt;</span>r[i])(lst)
x.qFilter = qFilter = genWrap _qFilter</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><strong>qPipe</strong> =&gt; [(a -&gt; Q a)] -&gt; (a -&gt; Q a)</p>
<p>Can’t be genWrap’d due to unknown arg count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.qPipe = qPipe = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_qPipe</span> = <span class="hljs-params">(f1,f2)</span> -&gt;</span>
    () -&gt; f1.apply(<span class="hljs-literal">null</span>, arguments).<span class="hljs-keyword">then</span> (x) -&gt; f2(x)
  
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
<span class="hljs-function">  <span class="hljs-title">q</span> = <span class="hljs-params">()</span> -&gt;</span> fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-literal">null</span>, arguments)
  <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
    q = _qPipe(q, fcn)
  q
  
  


defers.forEach (fcn) -&gt; fcn()</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Speed testing</p>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>_splitLast = (n) -&gt; (lst) -&gt; [(lst[i] for i in [0…n-1]), lst[n-1]]
_apply = (f, args, x) -&gt; xs = (args[i] for i in [0…args.length]); xs.push x; f.apply(null, xs)
_pApply = (f, args) -&gt; (x) -&gt; _apply(f, args, x)
altPipeWrap = (f) -&gt;
 split = _splitLast f.length
 () -&gt;
   [args, g] = split arguments
   if _isFunction g
     altPipeWrap () -&gt; _apply f, args, g.apply(null, arguments)
   else if g == undefined and f.length &gt; 0
     altPipeWrap (x) -&gt; _apply f, args, x
   else if _isPromise g
     g.then (val) -&gt; _apply f, args, val 
   else
     _apply f, args, g</p>
<p>_map2 = (fcn, lst) -&gt;
 result = []
 for item in lst
   result.push fcn(item)
 result</p>
<p>_filter2 = (fcn, lst) -&gt;
 r = []
 for item in lst
   r.push item if fcn item
 r</p>
<p>data = [33..122]
f = String.fromCharCode
flt = (x) -&gt; x &lt; “b”</p>
<p>n = 1500000</p>
<p>test = (fcn) -&gt; 
 t0 = Date.now()
 for i in [0…n]
   fcn()
 p Date.now() - t0</p>
<p>f1 = filter flt, map f
p f1 [66,67,68]
test (-&gt; f1 data)</p>
<p>f1 = (x) -&gt; _filter2 flt, _map2 f, x
p f1 [66,67,68]
test (-&gt; f1 data)</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
