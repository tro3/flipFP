<!DOCTYPE html>

<html>
<head>
  <title>flipFP.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>flipFP.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
x = <span class="hljs-built_in">module</span>.exports
p = <span class="hljs-built_in">console</span>.log

defers = []</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><strong>_maybeUncurry</strong> =&gt; (<em> -&gt; </em>) -&gt; (<em> -&gt; </em>)</p>
<p>Returns the curried function if passed a curried amount of parameters,
and the executed function if passed more</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_maybeUncurry</span> = <span class="hljs-params">(fn1, fn2)</span> -&gt;</span>
  () -&gt;
    <span class="hljs-keyword">if</span> arguments.length &gt; fn1.length
      fn2.apply(<span class="hljs-literal">null</span>,arguments)
    <span class="hljs-keyword">else</span>
      fn1.apply(<span class="hljs-literal">null</span>,arguments)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><strong>all</strong> =&gt; (a -&gt; Boolean) -&gt; ([a] -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_all</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  (lst) -&gt;
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> !(fn item)
    <span class="hljs-literal">true</span>
<span class="hljs-function"><span class="hljs-title">_all2</span> = <span class="hljs-params">(fn, lst)</span> -&gt;</span> _all(fn)(lst)    
x.all = all = _maybeUncurry _all, _all2</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>allPass</strong> =&gt; [(a -&gt; Boolean)] -&gt; (a -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_allPass</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
  (val) -&gt;
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> !(fcn val)
    <span class="hljs-literal">true</span>
<span class="hljs-function"><span class="hljs-title">_allPass2</span> = <span class="hljs-params">(lst, val)</span> -&gt;</span> _allPass(lst)(val)    
x.allPass = allPass = _maybeUncurry _allPass, _allPass2</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong>always</strong> =&gt; a -&gt; (* -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.always = always = <span class="hljs-function"><span class="hljs-params">(val)</span> -&gt;</span>
  () -&gt; val</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong>any</strong> =&gt; (a -&gt; Boolean) -&gt; ([a] -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_any</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  (lst) -&gt;
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> (fn item)
    <span class="hljs-literal">false</span>
<span class="hljs-function"><span class="hljs-title">_any2</span> = <span class="hljs-params">(fn, lst)</span> -&gt;</span> _any(fn)(lst)    
x.any = any = _maybeUncurry _any, _any2</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>anyPass</strong> =&gt; [(a -&gt; Boolean)] -&gt; (a -&gt; Boolean)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_anyPass</span> = <span class="hljs-params">(lst)</span> -&gt;</span>
  (val) -&gt;
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> (fcn val)
    <span class="hljs-literal">false</span>
<span class="hljs-function"><span class="hljs-title">_anyPass2</span> = <span class="hljs-params">(lst, val)</span> -&gt;</span> _anyPass(lst)(val)    
x.anyPass = anyPass = _maybeUncurry _anyPass, _anyPass2</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>chain</strong> =&gt; (a -&gt; []) -&gt; ([a] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.chain = chain = <span class="hljs-function"><span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> fcn(item)
        result.push res
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>compose</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.compose = compose = <span class="hljs-function">-&gt;</span>
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  fcns = fcns.reverse()
  () -&gt;
    val = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
      val = fcn(val)
    val</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>concat</strong> =&gt; []… -&gt; []</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.concat = concat = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
  result = []
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..arguments.length]
    list = arguments[i]
    list = [list] <span class="hljs-keyword">if</span> !(list <span class="hljs-keyword">instanceof</span> Array)
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> list
      result.push item
  result</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>composeP</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.composeP = composeP = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_pipeP</span> = <span class="hljs-params">(f1,f2)</span> -&gt;</span>
    () -&gt; f1.apply(<span class="hljs-number">0</span>, arguments).<span class="hljs-keyword">then</span> (x) -&gt; f2(x)
  
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  fcns = fcns.reverse()
  q = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
  reduce(_pipeP, q, fcns[<span class="hljs-number">1.</span>.])</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>clone</strong> =&gt; {} -&gt; {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>defers.push -&gt;
  x.clone = clone = traverseObj id,id,id</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>drop</strong> =&gt; Int -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_drop</span> = <span class="hljs-params">(n)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [n...lst.length]
      r.push lst[i]
    r
<span class="hljs-function"><span class="hljs-title">_drop2</span> = <span class="hljs-params">(n, lst)</span> -&gt;</span> _drop(n)(lst)
x.drop = drop = _maybeUncurry _drop, _drop2</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>filter</strong> =&gt; (a -&gt; a) -&gt; ([] -&gt; [])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_filter</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      r.push item <span class="hljs-keyword">if</span> fcn item
    r
<span class="hljs-function"><span class="hljs-title">_filter2</span> = <span class="hljs-params">(n, lst)</span> -&gt;</span> _filter(n)(lst)
x.filter = filter = _maybeUncurry _filter, _filter2</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>id</strong> =&gt; a -&gt; a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.id = id = <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> a</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>keys</strong> =&gt; ({} -&gt; [String])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.keys = keys = <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span> Object.keys a</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>map</strong> =&gt; (a -&gt; a) -&gt; ([a] -&gt; [a])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_map</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> lst
      result.push fcn(item)
    result
<span class="hljs-function"><span class="hljs-title">_map2</span> = <span class="hljs-params">(fcn, lst)</span> -&gt;</span> _map(fcn)(lst)
x.map = map = _maybeUncurry _map, _map2</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>mapIndex</strong> =&gt; (a,Int -&gt; a) -&gt; ([a] -&gt; [a])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_mapIndex</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (lst) -&gt;
    result = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..lst.length]
      result.push fcn(lst[i], i)
    result
<span class="hljs-function"><span class="hljs-title">_mapIndex2</span> = <span class="hljs-params">(fcn, lst)</span> -&gt;</span> _mapIndex(fcn)(lst)
x.mapIndex = mapIndex = _maybeUncurry _mapIndex, _mapIndex2</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>mapObj</strong> =&gt; (a -&gt; a) -&gt; ({} -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.mapObj = mapObj = <span class="hljs-function"><span class="hljs-params">(fcn)</span> -&gt;</span>
  (obj) -&gt;
    result = {}
    <span class="hljs-keyword">for</span> key, item <span class="hljs-keyword">of</span> obj
      result[key] = fcn(item)
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>reduce</strong> =&gt; (a -&gt; a) -&gt; ({} -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.reduce = reduce = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_reduce</span> = <span class="hljs-params">(fcn, init, lst)</span> -&gt;</span>
    acc = init
    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> lst
      acc = fcn(acc, val)
    acc

  fcn = arguments[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> arguments.length &gt; <span class="hljs-number">1</span>
    init = arguments[<span class="hljs-number">1</span>]
    (lst) -&gt; _reduce(fcn, init, lst)
  <span class="hljs-keyword">else</span>
    (init, lst) -&gt; _reduce(fcn, init, lst)</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>pipe</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.pipe = pipe = <span class="hljs-function">-&gt;</span>
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  () -&gt;
    val = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
    <span class="hljs-keyword">for</span> fcn <span class="hljs-keyword">in</span> fcns[<span class="hljs-number">1.</span>.]
      val = fcn(val)
    val</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><strong>pipeP</strong> =&gt; [(a -&gt; a)] -&gt; (a -&gt; a)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.pipeP = pipeP = <span class="hljs-function">-&gt;</span>
<span class="hljs-function">  <span class="hljs-title">_pipeP</span> = <span class="hljs-params">(f1,f2)</span> -&gt;</span>
    () -&gt; f1.apply(<span class="hljs-number">0</span>, arguments).<span class="hljs-keyword">then</span> (x) -&gt; f2(x)
  
  fcns = []
  <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> arguments
    fcns.push item
  q = fcns[<span class="hljs-number">0</span>].apply(<span class="hljs-number">0</span>, arguments)
  reduce(_pipeP, q, fcns[<span class="hljs-number">1.</span>.])</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>take</strong> =&gt; Int -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_take</span> = <span class="hljs-params">(n)</span> -&gt;</span>
  (lst) -&gt;
    r = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..n]
      r.push lst[i]
    r
<span class="hljs-function"><span class="hljs-title">_take2</span> = <span class="hljs-params">(n, lst)</span> -&gt;</span> _take(n)(lst)
x.take = take = _maybeUncurry _take, _take2</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>traverseObj</strong> =&gt; (a -&gt; a) -&gt; ({} -&gt; {}) -&gt; ({} -&gt; {}) -&gt; ({} -&gt; {})</p>
<p>The first object function is executed before descending, the second operates
on the object resulting after descending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>x.traverseObj = traverseObj = <span class="hljs-function"><span class="hljs-params">(valFcn, preFcn, postFcn)</span> -&gt;</span>
<span class="hljs-function">  <span class="hljs-title">loopFn</span> = <span class="hljs-params">(val)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> val <span class="hljs-keyword">instanceof</span> Array <span class="hljs-keyword">then</span> loopOverList val
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> val == <span class="hljs-string">'object'</span> <span class="hljs-keyword">then</span> processObj val
    <span class="hljs-keyword">else</span> valFcn val

  loopOverObj = mapObj loopFn
  loopOverList = _map loopFn
  
  processObj = pipe(
    preFcn
    loopOverObj
    postFcn
  )</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>zipObj</strong> =&gt; [] -&gt; ([] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_zip</span> = <span class="hljs-params">(keys)</span> -&gt;</span>
  (vals) -&gt;
    r = {}
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..keys.length]
      r[keys[i]] = vals[i]
    r
<span class="hljs-function"><span class="hljs-title">_zip2</span> = <span class="hljs-params">(keys, vals)</span> -&gt;</span> _zip(keys)(vals)
x.zipObj = zipObj = _maybeUncurry _zip, _zip2</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>zipKeys</strong> =&gt; (String -&gt; a) -&gt; ([String] -&gt; {})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">_zipKeys</span> = <span class="hljs-params">(fcn)</span> -&gt;</span>
  (keys) -&gt;
    r = {}
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys
      r[key] = fcn key
    r
<span class="hljs-function"><span class="hljs-title">_zipKeys2</span> = <span class="hljs-params">(fcn, keys)</span> -&gt;</span> _zipKeys(fcn)(keys)
x.zipKeys = zipKeys = _maybeUncurry _zipKeys, _zipKeys2



defers.forEach (fcn) -&gt; fcn()</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Speed testing</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>keys = [‘a’,’b’,’c’,’d’,’e’]
vals = [1,2,3,4,5]
f0 = _zip keys
f1 = zip keys
n=1000000</p>
<p>t0 = Date.now()
for i in [0…n]
 f0 vals
p Date.now() - t0</p>
<p>t0 = Date.now()
for i in [0…n]
 f1 vals
p Date.now() - t0</p>
<p>t0 = Date.now()
for i in [0…n]
 zip keys, vals
p Date.now() - t0</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
